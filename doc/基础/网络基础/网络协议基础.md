

# 1:网络体系结构

TCP/IP 模型划分为 四层

OSI 模型划分为 七层

![image-20211208222016675](https://raw.githubusercontent.com/Androidkobe/upload-image-note-learnmore/master/img/image-20211208222016675.png)



![image-20211208222522739](https://raw.githubusercontent.com/Androidkobe/upload-image-note-learnmore/master/img/image-20211208222522739.png)





![image-20211208222659905](https://raw.githubusercontent.com/Androidkobe/upload-image-note-learnmore/master/img/image-20211208222659905.png)





![image-20211208223202107](https://raw.githubusercontent.com/Androidkobe/upload-image-note-learnmore/master/img/image-20211208223202107.png)

Http3 使用UDT 基于光纤，海量数据 动态提高变化带宽(基于udp 自己实现连接 重传 )



mac 地址是物理地址 写入机器中

![image-20211208225514550](https://raw.githubusercontent.com/Androidkobe/upload-image-note-learnmore/master/img/202112082255582.png)



IP 地址是逻辑地址，可以更改

![image-20211208225750475](https://raw.githubusercontent.com/Androidkobe/upload-image-note-learnmore/master/img/202112082257503.png)

IP 地址主要 区分通讯子网:

网卡打包数据时会打入自己的mac地址

子网寻址：

A路由器 ->B路由器（保存子网中所有机器的IP地址+mac地址）->B路由器发送广播给每一个机器



多网卡多IP

![image-20211208230545284](https://raw.githubusercontent.com/Androidkobe/upload-image-note-learnmore/master/img/202112082305312.png)

网咯嗅探:

在子网中设置网卡不进行mac 地址不一样时进行不丢弃



端口号：应用程序的地址区分  属于传输层

标准既定端口号

0~1023

1024~49151

客户端：一般不需要 因为不提供服务

服务端：需要->需要提供（可以不设置 操作系统会分配 49152~65535）



NFC 蓝牙 4G CDMA TDMA FDM



![image-20211208231442421](https://raw.githubusercontent.com/Androidkobe/upload-image-note-learnmore/master/img/202112082314449.png)





![image-20211208232045659](https://raw.githubusercontent.com/Androidkobe/upload-image-note-learnmore/master/img/202112082320687.png)





![image-20211208232410144](https://raw.githubusercontent.com/Androidkobe/upload-image-note-learnmore/master/img/202112082324171.png)

# 三次握手&四次挥手

## 为什么三次握手？

保证双方都能知道seq序列号 的最小次数

## 为什么四次挥手？

TCP 是全双工（既可以在网络上读取 也可以在网络上发送）模式，

所以要双方都确认不读取也不发送了，所以需要四次。

## 四次挥手为什么服务器第二次和第三次不能合并发送？

理论上是，实际中会进行合并，会变成2次或者三次

## 四次挥手什么时候会进行合并？

当服务器没有额外的数据发送给客户端时，会合并2和3 步骤

如果服务器还有数据发送给客户端，就会分开发送

## 为什么客户端需要一个TIME_WAITING状态？还有存在2*MSL时间？

第一个原因：服务器发送的数据数据丢失，当第三个发送后，需要客户端进行应答，但是当数据丢失时，客户端需要等待服务器重发数据，收到后再发送第4步确认关闭给服务器，所以需要等待一段时间才能转换为CLOSED状态，不能直接关闭

第二个原因：端口冲突；当客户端直接关闭时，另外一个程序以当前端口启动了，这时候当收到第二步骤后，直接关闭，会导致下一次服务器数据发送给当前启动程序的端口接收。造成数据混乱。

简单来说就是：确保可靠的4次挥手确认两端关闭，保证服务器迟来的消息能够顺利接收。



MSL 最长报文段寿命(存活的最长时间 RFC 2分钟) TIME_WAITING = 1~4分钟

seq = 序列号

ACK = 应答

SYN = 请求同步

![image-20211209222739003](https://raw.githubusercontent.com/Androidkobe/upload-image-note-learnmore/master/img/202112092227660.png)

抓包工具：

WIRESHARK

# 原生JDK网络编程

## 1:BIO 阻塞式

Socket：封装了 传输层 TCP  和网络 层IP

![image-20211212172158744](https://raw.githubusercontent.com/Androidkobe/upload-image-note-learnmore/master/img/202112121723934.png)



![image-20211212172408777](https://raw.githubusercontent.com/Androidkobe/upload-image-note-learnmore/master/img/202112121724808.png)





![image-20211212172435979](https://raw.githubusercontent.com/Androidkobe/upload-image-note-learnmore/master/img/202112121724009.png)



![image-20211212172504013](https://raw.githubusercontent.com/Androidkobe/upload-image-note-learnmore/master/img/202112121725046.png)



## 2：NIO- 多路复用式 



![image-20211212200445405](https://raw.githubusercontent.com/Androidkobe/upload-image-note-learnmore/master/img/202112122004434.png)



![image-20211212200402868](https://raw.githubusercontent.com/Androidkobe/upload-image-note-learnmore/master/img/202112122004902.png)





## buffer 抽象类

![image-20211213222157648](https://raw.githubusercontent.com/Androidkobe/upload-image-note-learnmore/master/img/202112132222829.png)



## ByteBuffer

![image-20211213222249801](https://raw.githubusercontent.com/Androidkobe/upload-image-note-learnmore/master/img/202112132222833.png)



Capacity ： 所写区域的容量的大小



position ：表示写数据 ，内存区域中将要写的下一个位置



limit ：最多可以在数组中写多少数据，没有限制的时候 limit = Capacity

写模式切换 到 读模式   --->模式的切换：方法  -> flip（）

写模式切换到读模式后：postion 移动到 0 ；limt 移动到 之前posiotn 位置，两者标记 读的起始位置 和结束位置， capactity 不会发生变化



byteBuffer使用：

![image-20211213223307343](https://raw.githubusercontent.com/Androidkobe/upload-image-note-learnmore/master/img/202112132233421.png)

